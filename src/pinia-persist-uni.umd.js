(function(a,r){typeof exports=="object"&&typeof module!="undefined"?module.exports=r():typeof define=="function"&&define.amd?define(r):(a=typeof globalThis!="undefined"?globalThis:a||self,a.piniaPersist=r())})(this,function(){"use strict";const a=uni.getSystemInfoSync().uniPlatform.toLocaleLowerCase()==="web",r=(e,t,n)=>{const s=e.storage,i=e.key||t.$id,f=a||(n==null?void 0:n.enforceCustomStorage);if(e.paths){const d=e.paths.reduce((c,g)=>(c[g]=t.$state[g],c),{});f&&s?s.setItem(i,JSON.stringify(d)):uni.setStorage({key:i,data:JSON.stringify(d)})}else f&&s?s.setItem(i,JSON.stringify(t.$state)):uni.setStorage({key:i,data:JSON.stringify(t.$state)})};var p=({options:e,store:t})=>{var n,s,i,f,d,c;if((n=e.persist)!=null&&n.enabled){const g=[{key:t.$id,storage:((s=e.persist)==null?void 0:s.H5Storage)||(window==null?void 0:window.sessionStorage)}],S=(f=(i=e.persist)==null?void 0:i.strategies)!=null&&f.length?(d=e.persist)==null?void 0:d.strategies:g;S.forEach(u=>{var h,m;const y=u.storage||((h=e.persist)==null?void 0:h.H5Storage)||(window==null?void 0:window.sessionStorage),l=u.key||t.$id;let o;a||((m=e.persist)==null?void 0:m.enforceCustomStorage)?o=y.getItem(l):o=uni.getStorageSync(l),o&&(t.$patch(JSON.parse(o)),r(u,t,e.persist))}),t.$subscribe(()=>{S.forEach(u=>{r(u,t,e.persist)})},{detached:!!((c=e.persist)!=null&&c.detached)})}};return p});
